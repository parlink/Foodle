{% extends 'base_content.html' %}
{% load static %}

{% block content %}
<div class="container my-5">
    <div class="row">
        <div class="col-12">
            <h1 class="display-4 text-center mb-4">My Recipes</h1>
            <p class="text-center">Total Recipes: {{ page.paginator.count }}</p>
        </div>
    </div>

    <!-- Sorting Buttons (Instead of dropdown) -->
    <div class="row mb-4 sorting-buttons">
        <div class="col-12 text-center">
            <form method="get" action="{% url 'my_recipes' %}">
                <button type="submit" name="sort_by" value="name" class="btn btn-custom {% if request.GET.sort_by == 'name' %}active{% endif %}">Alphabetical Order</button>
                <button type="submit" name="sort_by" value="rating" class="btn btn-custom {% if request.GET.sort_by == 'rating' %}active{% endif %}">By Rating</button>
                <button type="submit" name="sort_by" value="difficulty" class="btn btn-custom {% if request.GET.sort_by == 'difficulty' %}active{% endif %}">By Difficulty</button>
                <button type="submit" name="sort_by" value="time" class="btn btn-custom {% if request.GET.sort_by == 'time' %}active{% endif %}">By Time</button>
            </form>
        </div>
    </div>

    <!-- Alphabet Filter Banner (Only shown for alphabetical sort) -->
    {% if request.GET.sort_by == 'name' %}
    <div class="row mb-4">
        <div class="col-12 text-center alphabet-filter">
            <div class="btn-group" role="group">
                {% for letter in alphabet %}
                    <a href="?sort_by=name&letter={{ letter }}" class="btn btn-outline-secondary {% if letter == current_letter %}active{% endif %}">{{ letter }}</a>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Check if there are any recipes -->
    {% if page.object_list %}
    <div class="row">
        {% for recipe in page.object_list %}
        <div class="col-md-4 mb-4">
            <div class="card card-style">
                <div class="d-flex align-items-center p-4">
                    <!-- Recipe Image -->
                    <div class="mr-4 recipe-image">
                        <img src="{% static recipe.image %}" alt="{{ recipe.name }}" class="img-fluid rounded">
                    </div>


                    <!-- Recipe Summary -->
                    <div class="flex-grow-1 recipe-summary">
                        <h5 class="font-weight-bold text-dark mb-3">{{ recipe.name }}</h5>
                        <p class="mb-2"><strong>Personal Rating:</strong> {{ recipe.average_rating }}</p>
                        <p class="mb-2"><strong>Difficulty:</strong> {{ recipe.difficulty }}</p>
                        <p class="mb-2"><strong>Servings:</strong> {{ recipe.servings }}</p>
                        <p class="mb-2"><strong>Duration:</strong> {{ recipe.total_time }}</p>
                        <a href="{% url 'recipe_detail' recipe.id %}" class="btn btn-primary mt-2">View Recipe</a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-info" role="alert">
        No recipes found.
    </div>
    {% endif %}

    <!-- Pagination -->
    <div class="pagination justify-content-center mt-4">
        <span class="step-links">
            {% if page.has_previous %}
                <a href="?page=1" class="btn btn-outline-secondary">&laquo; First</a>
                <a href="?page={{ page.previous_page_number }}" class="btn btn-outline-secondary">Previous</a>
            {% endif %}

            <span class="current">
                Page {{ page.number }} of {{ page.paginator.num_pages }}.
            </span>

            {% if page.has_next %}
                <a href="?page={{ page.next_page_number }}" class="btn btn-outline-secondary">Next</a>
                <a href="?page={{ page.paginator.num_pages }}" class="btn btn-outline-secondary">Last &raquo;</a>
            {% endif %}
        </span>
    </div>
</div>
{% endblock %}
