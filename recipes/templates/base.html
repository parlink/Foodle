{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-uWxY/CJNBR+1zjPWmfnSnVxwRheevXITnMqoEIeG1LJrdI0GlVs/9cVSyPYXdcSF"
      crossorigin="anonymous"
    />
    <link href="{% static 'custom.css' %}" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css"
    />
    <title>foodle</title>
  </head>
  <body
    data-theme="{{ user_theme }}"
    data-theme-classes="{{ body_classes }}"
    data-theme-styles="{{ body_styles }}"
  >
    <script>
      (function () {
        var b = document.body;
        var theme = b.dataset.theme;
        var classes = b.dataset.themeClasses || '';
        
        // Handle system theme preference
        if (theme === 'system') {
          var prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
          if (prefersDark) {
            classes = classes ? classes + ' dark-mode' : 'dark-mode';
          }
        }
        
        if (classes) b.className = classes;
        if (b.dataset.themeStyles) b.style.cssText = b.dataset.themeStyles;
        
        // Listen for system theme changes (when user changes OS theme)
        if (theme === 'system') {
          window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
            if (e.matches) {
              b.classList.add('dark-mode');
            } else {
              b.classList.remove('dark-mode');
            }
          });
        }
      })();
    </script>
    <!-- SVG Filters for Color Blindness Modes (hidden) -->
    <svg style="position: absolute; width: 0; height: 0" aria-hidden="true">
      <defs>
        <!-- Protanopia filter -->
        <filter id="protanopia-filter" color-interpolation-filters="sRGB">
          <feColorMatrix
            type="matrix"
            values="0.567, 0.433, 0, 0, 0 0.558, 0.442, 0, 0, 0 0, 0.242, 0.758, 0, 0 0, 0, 0, 1, 0"
          />
        </filter>
        <!-- Deuteranopia filter -->
        <filter id="deuteranopia-filter" color-interpolation-filters="sRGB">
          <feColorMatrix
            type="matrix"
            values="0.625, 0.375, 0, 0, 0 0.7, 0.3, 0, 0, 0 0, 0.3, 0.7, 0, 0 0, 0, 0, 1, 0"
          />
        </filter>
        <!-- Tritanopia filter -->
        <filter id="tritanopia-filter" color-interpolation-filters="sRGB">
          <feColorMatrix
            type="matrix"
            values="0.95, 0.05, 0, 0, 0 0, 0.433, 0.567, 0, 0 0, 0.475, 0.525, 0, 0 0, 0, 0, 1, 0"
          />
        </filter>
      </defs>
    </svg>
    {% block body %} {% endblock %}
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
      integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/js/bootstrap.min.js"
      integrity="sha384-PsUw7Xwds7x08Ew3exXhqzbhuEYmA2xnwc8BuD6SEr+UmEHlX8/MCltYEodzWA4u"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
